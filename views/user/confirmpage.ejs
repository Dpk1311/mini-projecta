<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/easyinvoice/dist/easyinvoice.min.js"></script>
    <title>Document</title>
</head>

<body>
    <%- include('partials/navbar'),{user} %>
        <% if(data){ %>
            <div class="py-14 px-4 md:px-6 2xl:px-20 2xl:container 2xl:mx-auto">

                <div class="flex justify-start item-start space-y-2 flex-col">
                    <h1
                        class="text-3xl dark:text-white lg:text-4xl font-semibold leading-7 lg:leading-9 text-green-600">
                        Thankyou for
                        Ordering with us !!!</h1>
                    <p class="text-base dark:text-gray-300 font-medium leading-6 text-gray-600">21st Mart 2021 at 10:34
                        PM</p>
                </div>
                <div
                    class="mt-10 flex flex-col xl:flex-row jusitfy-center items-stretch w-full xl:space-x-8 space-y-4 md:space-y-6 xl:space-y-0">
                    <div class="flex flex-col justify-start items-start w-full space-y-4 md:space-y-6 xl:space-y-8">
                        <div
                            class="flex flex-col justify-start items-start dark:bg-gray-800 bg-gray-50 px-4 py-4 md:py-6 md:p-6 xl:p-8 w-full">
                            <p
                                class="text-lg md:text-xl dark:text-white font-semibold leading-6 xl:leading-5 text-gray-800">
                                Customer’s Cart</p>
                            <% data.products.forEach(element=> {
                                console.log('product is',element);%>
                                <div
                                    class="mt-4 md:mt-6 flex flex-col md:flex-row justify-start items-start md:items-center md:space-x-6 xl:space-x-8 w-full">
                                    <div class="pb-4 md:pb-8 w-full md:w-40">
                                        <img class="w-full hidden md:block" src="<%= element.product.Image %>"
                                            alt="dress" />
                                        <img class="w-full md:hidden" src="<%= element.product.Image %>" alt="dress" />
                                    </div>
                                    <div
                                        class="border-b border-gray-200 md:flex-row flex-col flex justify-between items-start w-full pb-8 space-y-4 md:space-y-0">
                                        <div class="w-full flex flex-col justify-start items-start space-y-8">
                                            <h3
                                                class="text-xl dark:text-white xl:text-2xl font-semibold leading-6 text-gray-800">
                                                <span>
                                                    <input class="productname" type="hidden"
                                                        value="<%- element.product.Name%>">
                                                    <%= element.product.Name %>
                                                </span>
                                            </h3>
                                            <div class="flex justify-start items-start flex-col space-y-2">
                                                <p class="text-sm dark:text-white leading-none text-gray-800"><span
                                                        class="dark:text-black text-black">Style: </span>
                                                    <%= element.product.Description%>
                                                </p>
                                                <p class="text-sm dark:text-white leading-none text-gray-800"><span
                                                        class="dark:text-black text-black">Size: </span>
                                                    <%= element.product.Size%>
                                                </p>
                                                <p class="text-sm dark:text-white leading-none text-gray-800"><span
                                                        class="dark:text-black text-black">Brand: </span>
                                                    <%= element.product.Brand%>
                                                </p>
                                            </div>
                                        </div>
                                        <div class="flex justify-between space-x-8 items-start w-full">
                                            <p class="text-base dark:text-white xl:text-lg leading-6">
                                                <input class="productprice" type="hidden"
                                                    value="<%- element.product.Price %>"> ₹<%=element.product.Price%>
                                            </p>
                                            <p class="text-base dark:text-white xl:text-lg leading-6 text-gray-800">
                                                <input class="productquantity" type="hidden"
                                                    value="<%- element.quantity %>">
                                                <%= element.quantity %>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <% }) %>
                        </div>
                        <div
                            class="flex justify-center flex-col md:flex-row flex-col items-stretch w-full space-y-4 md:space-y-0 md:space-x-6 xl:space-x-8">
                            <div
                                class="flex flex-col px-4 py-6 md:p-6 xl:p-8 w-full bg-gray-50 dark:bg-gray-800 space-y-6">
                                <h3 class="text-xl dark:text-white font-semibold leading-5 text-gray-800">Summary</h3>
                                <div
                                    class="flex justify-center items-center w-full space-y-4 flex-col border-gray-200 border-b pb-4">
                                    <div class="flex justify-between w-full">
                                        <p class="text-base dark:text-white leading-4 text-gray-800">Subtotal</p>
                                        <p class="text-base dark:text-gray-300 leading-4 text-gray-600">₹<%= subtotal %>
                                        </p>
                                    </div>


                                    <%# Discount%>

                                        <%# <div class="flex justify-between items-center w-full">
                                            <p class="text-base dark:text-white leading-4 text-gray-800">Discount <span
                                                    class="bg-gray-200 p-1 text-xs font-medium dark:bg-white dark:text-gray-800 leading-3 text-gray-800">STUDENT</span>
                                            </p>
                                            <p class="text-base dark:text-gray-300 leading-4 text-gray-600">-$28.00
                                                (50%)
                                            </p>
                                </div> %>

                                <div class="flex justify-between items-center w-full">
                                    <p class="text-base dark:text-white leading-4 text-gray-800">Shipping</p>
                                    <p class="text-base dark:text-gray-300 leading-4 text-gray-600">₹4.99</p>
                                </div>
                            </div>
                            <div class="flex justify-between items-center w-full">
                                <p class="text-base dark:text-white font-semibold leading-4 text-gray-800">Total</p>
                                <p class="text-base dark:text-gray-300 font-semibold leading-4 text-gray-600">₹<%=
                                        subtotal + 4.99 %>
                                </p>
                            </div>
                        </div>
                        <div
                            class="flex flex-col justify-center px-4 py-6 md:p-6 xl:p-8 w-full bg-gray-50 dark:bg-gray-800 space-y-6">
                            <h3 class="text-xl dark:text-white font-semibold leading-5 text-gray-800">Invoice</h3>
                            <div class="flex justify-between items-start w-full">
                                <div class="flex justify-center items-center space-x-4">
                                    <div class="w-8 h-8">
                                        <img class="w-full h-full" alt="logo"
                                            src="https://i.ibb.co/L8KSdNQ/image-3.png" />
                                    </div>
                                    <div class="flex flex-col justify-start items-center">
                                        <p class="text-lg leading-6 dark:text-white font-semibold text-gray-800">Details
                                            of your Order
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="w-full flex justify-center items-center">
                                <button onclick="downloadInvoice()"
                                    class="hover:bg-black dark:bg-white dark:text-gray-800 dark:hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-800 py-5 w-96 md:w-full bg-gray-800 text-base font-medium leading-4 text-white">View
                                    Invoice</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div
                    class="bg-gray-50 dark:bg-gray-800 w-full xl:w-96 flex justify-between items-center md:items-start px-4 py-6 md:p-6 xl:p-8 flex-col">
                    <h3 class="text-xl dark:text-white font-semibold leading-5 text-gray-800">Customer</h3>
                    <div
                        class="flex flex-col md:flex-row xl:flex-col justify-start items-stretch h-full w-full md:space-x-6 lg:space-x-8 xl:space-x-0">
                        <div class="flex flex-col justify-start items-start flex-shrink-0">
                            <div
                                class="flex justify-center w-full md:justify-start items-center space-x-4 py-8 border-b border-gray-200">
                                <img src="https://i.ibb.co/5TSg7f6/Rectangle-18.png" alt="avatar" />
                                <div class="flex justify-start items-start flex-col space-y-2">
                                    <p id="nameinvoice"
                                        class="text-base dark:text-white font-semibold leading-4 text-left text-gray-800">
                                        <%= user.name %>
                                    </p>
                                    <p class="text-sm dark:text-gray-300 leading-5 text-gray-600">10 Previous Orders
                                    </p>
                                </div>
                            </div>

                            <div
                                class="flex justify-center text-gray-800 dark:text-white md:justify-start items-center space-x-4 py-4 border-b border-gray-200 w-full">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M19 5H5C3.89543 5 3 5.89543 3 7V17C3 18.1046 3.89543 19 5 19H19C20.1046 19 21 18.1046 21 17V7C21 5.89543 20.1046 5 19 5Z"
                                        stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" />
                                    <path d="M3 7L12 13L21 7" stroke="currentColor" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                </svg>
                                <p class="cursor-pointer text-sm leading-5 ">
                                    <%= user.email%>
                                </p>
                            </div>
                        </div>
                        <div class="flex justify-between xl:h-full items-stretch w-full flex-col mt-6 md:mt-0">
                            <div
                                class="flex justify-center md:justify-start xl:flex-col flex-col md:space-x-6 lg:space-x-8 xl:space-x-0 space-y-4 xl:space-y-12 md:space-y-0 md:flex-row items-center md:items-start">
                                <div
                                    class="flex justify-center md:justify-start items-center md:items-start flex-col space-y-4 xl:mt-8">
                                    <p
                                        class="text-base dark:text-white font-semibold leading-4 text-center md:text-left text-gray-800">
                                        Shipping Address</p>
                                    <% data.selectedAddress.forEach(element=> { %>
                                        <p
                                            class="w-48 lg:w-full dark:text-gray-300 xl:w-48 text-center md:text-left text-sm leading-5 text-gray-600">

                                            <%= element.street%>,
                                                <%= element.city%>,
                                                    <%= element.state%>
                                                        <%= element.pincode%>


                                        </p>

                                </div>
                                <div
                                    class="flex justify-center md:justify-start items-center md:items-start flex-col space-y-4">
                                    <p
                                        class="text-base dark:text-white font-semibold leading-4 text-center md:text-left text-gray-800">
                                        Billing Address</p>
                                    <p
                                        class="w-48 lg:w-full dark:text-gray-300 xl:w-48 text-center md:text-left text-sm leading-5 text-gray-600">
                                        <span id="addressstreet">
                                            <%= element.street%>
                                        </span>
                                        <span id="addresscity">
                                            <%= element.city%>
                                        </span>
                                        <span id="addressstate">
                                            <%= element.state%>
                                        </span>
                                        <span id="addresspincode">
                                            <%= element.pincode%>
                                        </span>
                                    </p>
                                </div>
                                <% }) %>
                            </div>
                            <div class="flex w-full justify-center items-center md:justify-start md:items-start">
                                <button
                                    class="mt-6 md:mt-0 dark:border-white dark:hover:bg-gray-900 dark:bg-transparent dark:text-white py-5 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-800 border border-gray-800 font-medium w-96 2xl:w-full text-base font-medium leading-4 text-gray-800">Edit
                                    Details</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
            <% } else { %> <!-- Handle the case where data is null or undefined -->
                <p>Product not found.</p>
                <% } %>
</body>
<script>


    const name = document.getElementById('nameinvoice').textContent
    console.log('name_is', name)
    const street = document.getElementById('addressstreet').textContent
    console.log('address_is', street)
    const city = document.getElementById('addresscity').textContent
    console.log('address_is', city)
    const state = document.getElementById('addressstate').textContent
    console.log('address_is', state)
    const pincode = document.getElementById('addresspincode').textContent
    console.log('address_is', pincode)
    const productnames = document.querySelectorAll('.productname');
    const productquantitys = document.querySelectorAll('.productquantity')
    const productprices = document.querySelectorAll('.productprice')

    const productsnamearray = []
    const productsquantityarray = []
    const productspricearray = []

    productnames.forEach(element => {
        const productnames = element.value
        productsnamearray.push(productnames)
    });
    productquantitys.forEach(element => {
        const productquantitys = element.value
        productsquantityarray.push(productquantitys)
    })

    productprices.forEach(element => {
        const productprices = element.value
        productspricearray.push(productprices)
    })
    console.log('product name', productsnamearray);
    console.log('product_quantity', productsquantityarray);
    console.log('product_price', productspricearray);

    function downloadInvoice() {
        var data = {
            // Customize enables you to provide your own templates
            // Please review the documentation for instructions and examples
            "customize": {
                //  "template": fs.readFileSync('template.html', 'base64') // Must be base64 encoded html 
            },
            "images": {
                // The logo on top of your invoice
                "logo": "https://public.easyinvoice.cloud/img/logo_en_original.png",
                // The invoice background
                "background": "https://public.easyinvoice.cloud/img/watermark-draft.jpg"
            },
            // Your own data
            "sender": {
                "company": "VASTRA Private Inc",
                "address": "New field, Pink City",
                "zip": "987112",
                "city": "SquareCity",
                "country": "India"
            },
            // Your recipient
            "client": {
                "company": name,
                "address": street,
                "city": city,
                "country": state,
                "zip": pincode,

            },
            "information": {
                // Invoice number
                "number": "2021.0001",
                // Invoice data
                "date": "12-12-2021",
                // Invoice due date
                "due-date": "31-12-2021"
            },
            // The products you would like to see on your invoice
            // Total values are being calculated automatically
            "products": [{}],
            // The message you would like to display on the bottom of your invoice
            "bottom-notice": "Kindly pay your invoice within 15 days.",
            // Settings to customize your invoice
            "settings": {
                "currency": "INR", // See documentation 'Locales and Currency' for more info. Leave empty for no currency.
                // "locale": "nl-NL", // Defaults to en-US, used for number formatting (See documentation 'Locales and Currency')        
                // "margin-top": 25, // Defaults to '25'
                // "margin-right": 25, // Defaults to '25'
                // "margin-left": 25, // Defaults to '25'
                // "margin-bottom": 25, // Defaults to '25'
                // "format": "A4", // Defaults to A4, options: A3, A4, A5, Legal, Letter, Tabloid
                // "height": "1000px", // allowed units: mm, cm, in, px
                // "width": "500px", // allowed units: mm, cm, in, px
                // "orientation": "landscape", // portrait or landscape, defaults to portrait
            },
            // Translate your invoice to your preferred language
            "translate": {
                // "invoice": "FACTUUR",  // Default to 'INVOICE'
                // "number": "Nummer", // Defaults to 'Number'
                // "date": "Datum", // Default to 'Date'
                // "due-date": "Verloopdatum", // Defaults to 'Due Date'
                // "subtotal": "Subtotaal", // Defaults to 'Subtotal'
                // "products": "Producten", // Defaults to 'Products'
                // "quantity": "Aantal", // Default to 'Quantity'
                // "price": "Prijs", // Defaults to 'Price'
                // "product-total": "Totaal", // Defaults to 'Total'
                // "total": "Totaal", // Defaults to 'Total'
                // "vat": "btw" // Defaults to 'vat'
            },
        };

        const products = [];

        // Calculate the subtotal
        let subtotal = 0;

        for (let i = 0; i < productsnamearray.length; i++) {
            const productName = productsnamearray[i];
            const productQuantity = parseFloat(productsquantityarray[i]);
            const productPrice = parseFloat(productspricearray[i]);

            // Calculate the total for the product
            const productTotal = productQuantity * productPrice;

            // Add the product total to the subtotal
            subtotal += productTotal;

            products.push({
                "description": productName,
                "quantity": productQuantity,
                "price": productPrice
            });
        }

        // Add shipping charges to the subtotal
        const shippingCharges = 4.99;
        const total = subtotal + shippingCharges;

        
        delete data.translate.vat;

        // Set the 'products' array within the 'data' object
        data.products = products;

        // Set the 'total' in 'data' and remove 'vat' from 'translate'
        data.total = total;
        

        easyinvoice.createInvoice(data, function (result) {
            //The response will contain a base64 encoded PDF file
            console.log(result.pdf)
            easyinvoice.download("Invoice.pdf")
        });
    }


</script>

</html> 